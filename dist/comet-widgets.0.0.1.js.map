{"version":3,"file":"comet-widgets.0.0.1.js","sources":["../src/comet-services.ts","../src/comet-utils.ts","../src/carousel/carousel-template.ts","../src/carousel/carousel.ts"],"sourcesContent":["import $ from 'jquery';\nimport Promise from \"core-js/library\"\n\nimport { AlbumModel, MediaModel } from \"./models/index\"\nimport { Utils } from \"./comet-utils\"\n\nexport default class ApiService {\n\n  public static API_URL = 'https://api.cometapp.io/v2/';\n\n  public static getAlbum(uuid: string): Promise<AlbumModel> {\n    return $.get(`${ApiService.API_URL}albums/${uuid}`)\n      .then(response => response.data as AlbumModel)\n      .catch(handleError);\n  }\n\n  public static getAlbumByShortId(shortId: string): Promise<AlbumModel> {\n    return $.get(`${ApiService.API_URL}albums/short_id/${shortId}`)\n      .then(response => response.data as AlbumModel)\n      .catch(handleError);\n  }\n\n  public static getAlbumMedias(uuid: string, params: object): Promise<MediaModel[]> {\n    let url = `${ApiService.API_URL}albums/${uuid}/medias`;\n    if (params) {\n      url = `${url}?${$.param(params)}`;\n    }\n    return $.get(url)\n      .then(response => response.data as MediaModel[])\n      .catch(handleError);\n  }\n}\n\nfunction handleError(response: any): any {\n  if (response.responseText) {\n    let err = JSON.parse(response.responseText);\n    console.error(`(${err.code} ${err.message}) ${err.error.type}: ${err.error.message}`);\n  }\n  return {};\n}\n","import $ from 'jquery';\n\n// const $window = $(window);\n\nexport class Utils {\n\n  public static isUuid(uuid: string): boolean {\n    if (!uuid || uuid.length !== 24 || !uuid.match(/[a-f0-9]/)) {\n      return false;\n    }\n    return true;\n  }\n\n  public static bestMediaFormat(): string {\n    class Format { name: string; size: number; constructor(name: string, size: number) { this.name = name; this.size = size; } }\n    let mediaFormats: Format[] = [\n      new Format('s', 370),\n      new Format('m', 555),\n      new Format('l', 1110),\n      new Format('xl', 1242),\n    ];\n    let w = {\n      width: $(window).width() || 0,\n      height: $(window).height() || 0,\n    };\n    let size = Math.max(w.width, w.height);\n    let format = 'xl';\n    for (let i = 0; i < mediaFormats.length; i++) {\n      if (mediaFormats[i].size > size) {\n        format = mediaFormats[i].name;\n        break\n      }\n    }\n    // for (let i in mediaFormats) {\n    //   if (mediaFormats[i] > size) {\n    //     format = (i as string);\n    //     break\n    //   }\n    // }\n    return format;\n  }\n\n}\n","import $ from 'jquery';\nimport 'bootstrap';\n\nexport class CarouselTemplate {\n\n  public static renderWait(options: any) {\n    let carousel: any = { id: options.id, slides: [], tpls: { indicators: '', items: '' } };\n    let template = CarouselTemplate.getTemplate('global', { carousel });\n    CarouselTemplate.display(template, options);\n  }\n\n  public static render(slides: string[], options: any) {\n    // Create the carousel object\n    let tpls: any = { indicators: '', items: '' };\n    let carousel: any = { id: options.id, slides: slides, tpls: tpls };\n\n    // Render the subtemplates\n    for (let i in carousel.slides) {\n      tpls.indicators = tpls.indicators + CarouselTemplate.getTemplate('indicator', { carousel, i });\n    }\n    for (let i in carousel.slides) {\n      tpls.items = tpls.items + CarouselTemplate.getTemplate('item', { carousel, i });\n    }\n\n    // Render the template & append to body\n    let template = CarouselTemplate.getTemplate('global', { carousel });\n    CarouselTemplate.display(template, options);\n    CarouselTemplate.start(options);\n  }\n\n  // restart a stopped carousel\n  public static restart(options: any) {\n    $(`#${options.id}`)\n      .fadeIn()\n      .carousel('cycle');\n  }\n\n  // stop the carousel\n  public static stop(options: any) {\n    $(`#${options.id}`)\n      .fadeOut()\n      .carousel('pause');\n  }\n\n  // move to a slide\n  public static goTo(nb: number, options: any) {\n    $(`#${options.id}`)\n      .carousel(`${nb}`);\n  }\n\n  protected static display(template: string, options: any) {\n\n    // Replace\n    if ($(`#${options.id}`).length) {\n      $(`#${options.id}`).replaceWith(template);\n    } else {\n      $('body').append(template);\n    }\n    let $items = $(`#${options.id} .item`);\n    let windowHeight = ($(window).height() as number);\n    // if I do that in the template, carousel is not working\n    $items.eq(0).addClass('active');\n    $items\n      .height(windowHeight)\n      .css({\n        backgroundColor: 'black',\n        backgroundSize: 'contain',\n        backgroundPosition: 'center',\n        backgroundRepeat: 'no-repeat',\n      });\n    // transform the imgs into background-images\n    $(`#${options.id} img`).each(function() {\n      let src = $(this).attr('src');\n      $(this).parent('.item').css({ backgroundImage: `url(${src})` });\n      $(this).remove();\n    });\n\n    // on resize\n    $(window).on('resize', () => {\n      let windowHeight = ($(window).height() as number);\n      $items.height(windowHeight);\n    });\n\n    // Display the template\n    $(`#${options.id}`)\n      .css({\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%'\n      });\n  }\n\n  // start the carousel\n  protected static start(options: any) {\n    $(`#${options.id}`)\n      .hide()\n      .carousel({\n        pause: 'false',\n        interval: options.interval,\n        wrap: options.loop\n      })\n      .fadeIn();\n  }\n\n  protected static getTemplate(template: string, params: any): string {\n    let { carousel, i } = params;\n    const global = `\n    <div id=\"${carousel.id}\" class=\"carousel slide\" data-ride=\"carousel\">\n      <!-- Indicators -->\n      <!-- <ol class=\"carousel-indicators\">\n        ${carousel.tpls.indicators}\n      </ol> -->\n\n      <!-- Slides -->\n      <div class=\"carousel-inner\" role=\"listbox\">\n        ${carousel.tpls.items}\n      </div>\n\n      <!-- Controls -->\n      <!-- <a class=\"left carousel-control\" href=\"#${carousel.id}\" role=\"button\" data-slide=\"prev\">\n        <span class=\"glyphicon glyphicon-chevron-left\" aria-hidden=\"true\"></span>\n        <span class=\"sr-only\">Previous</span>\n      </a>\n      <a class=\"right carousel-control\" href=\"#${carousel.id}\" role=\"button\" data-slide=\"next\">\n        <span class=\"glyphicon glyphicon-chevron-right\" aria-hidden=\"true\"></span>\n        <span class=\"sr-only\">Next</span>\n      </a> -->\n    </div>`;\n    const indicator = `\n      <li data-target=\"#${carousel.id}\" data-slide-to=\"${i}\"${i===0?' class=\"active\"':''}></li>`;\n    const item = `\n      <div class=\"item\"><img src=\"${carousel.slides[i]}\" /></div>`;\n\n    switch (template) {\n      case \"global\":\n        return global;\n      case \"indicator\":\n        return indicator;\n      case \"item\":\n        return item;\n      default:\n        return '';\n    }\n  }\n\n}\n","import $ from 'jquery';\n\nimport ApiService from '../comet-services'\nimport { AlbumModel, MediaModel } from '../models/index'\nimport { Utils } from '../comet-utils'\n\nimport { CarouselTemplate } from './carousel-template'\n\n// Carousel component\nexport class Carousel {\n\n  // state control\n  private load: Promise<boolean>;\n  private loaded: boolean; // if true, the data is loaded\n  private cycling: boolean; // if false, the slider is stopped\n\n  private options: any;\n  private album: AlbumModel;\n  private medias: MediaModel[];\n  private choosenFormat: string;\n\n  constructor(public id: string, userOptions: any = {}) {\n\n    // Check dependencies\n    if (typeof $ === 'undefined') {\n      console.error('jQuery was not found');\n      return;\n    }\n    if (!$.fn.carousel) {\n      console.error('bootstrap was not found');\n      return;\n    }\n\n    // Get the data\n    this.load = new Promise<boolean>((resolve, reject) => {\n\n      if (!id) {\n        reject(false);\n        console.error('An album id is a required parameter');\n        return;\n      }\n\n      // Define the options\n      let defaultOptions = {\n        selector: null,  // TODO if a selector is specified, the carousel is not fullscreen\n        interval: 5000,  // duration of every picture\n        infos:    true,  // TODO wether to display photo informations, like the user or the date\n        watch:    false, // TODO will regularily ask the server for new pictures and auto-update itself\n        loop:     true   // will start again when reached the last picture\n      };\n      delete userOptions.id;\n      this.options = $.extend({}, defaultOptions, userOptions);\n      if (this.options.selector && this.options.selector.match(/^\\#[a-zA-Z0-9\\_\\-]+$/g)) {\n        this.options.id = this.options.selector.substring(1);\n      } else {\n        this.options.id = `comet-gallery-${Math.floor(Math.random() * 1000)}`;\n      }\n\n      // Find the album & the medias\n      let promise: Promise<AlbumModel>;\n      if (Utils.isUuid(id)) {\n        promise = ApiService.getAlbum(id);\n      } else {\n        promise = ApiService.getAlbumByShortId(id);\n      }\n      promise.then(album => {\n\n        // Set data\n        if (!album.uuid) {\n          reject(false);\n          return;\n        }\n        this.album = album;\n\n        // Then find the medias\n        this.choosenFormat = Utils.bestMediaFormat();\n        ApiService.getAlbumMedias(album.uuid, { format: this.choosenFormat }).then(medias  => {\n\n          // Set data\n          if (!medias.length) {\n            reject(false);\n            return;\n          }\n          this.medias = medias;\n          resolve(true);\n\n          console.info(`%c${medias.length} %cmedias in the album %c${album.title}`, 'color:blue', 'color:black', 'color:blue');\n        })\n      });\n\n    });\n  }\n\n  // Start to display the carousel\n  start(firstSlide?: number): Promise<boolean> {\n\n    if (!this.load) {\n      return Promise.reject(false);\n    }\n\n    // If it's a restart\n    if (this.loaded && !this.cycling) {\n      this.restart(firstSlide);\n      return Promise.resolve(true);\n    }\n\n    // Render the waiting page\n    CarouselTemplate.renderWait(this.options);\n\n    // When the medias are loaded\n    return this.load.then(() => {\n\n      // If parallel loadiation\n      if (this.loaded) {\n        return Promise.resolve(true);\n      }\n\n      // If problem with data\n      if (!this.album || !this.medias) {\n        console.error('could not start the carousel');\n        return Promise.reject(false);\n      }\n\n      // Set state\n      this.loaded = true;\n\n      // Render the carousel\n      let slides: string[] = [];\n      for (let i in this.medias) {\n        slides.push((this.medias[i].formats[this.choosenFormat] as string));\n      }\n      CarouselTemplate.render(slides, this.options);\n      // if (firstSlide) {\n      //   CarouselTemplate.goTo(firstSlide, this.options);\n      // }\n\n      // Set state\n      this.cycling = true;\n\n      return Promise.resolve(true);\n    })\n    .catch(_ => {\n      console.error('could not start the carousel');\n      return Promise.reject(false);\n    })\n  }\n\n  // Hide the carousel\n  stop() {\n    // Set state\n    this.cycling = false;\n    // Stop\n    CarouselTemplate.stop(this.options);\n  }\n\n  // If the carousel was stopped, restart it\n  private restart(firstSlide?: number) {\n    // Set state\n    this.cycling = true;\n    // Restart\n    CarouselTemplate.restart(this.options);\n    // if (firstSlide) {\n    //   CarouselTemplate.goTo(firstSlide, this.options);\n    // }\n  }\n}\n"],"names":[],"mappings":"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"}